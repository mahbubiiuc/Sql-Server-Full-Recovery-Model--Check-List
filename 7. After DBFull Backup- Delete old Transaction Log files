
-- DATABASE Full Backup
-- Backup Drive (D:\Bluechip_DB)
DECLARE @FileName NVARCHAR(255);
DECLARE @DateSuffix NVARCHAR(50);

SET @DateSuffix = FORMAT(GETDATE(), 'yyyyMMdd_HHmmss');
SET @FileName = 'D:\Bluechip_DB\MINTDB_' + @DateSuffix + '.bak';

DECLARE @SQL NVARCHAR(MAX) = 'BACKUP DATABASE MINTDB TO DISK = ''' + @FileName + ''' WITH INIT, COMPRESSION, STATS = 5;';	
EXEC(@SQL);

GO

-- Delete old transaction log files after DB full backup
-- Backup Drive (L:\MintDB_Transaction_Log_Files)
DECLARE @LastFullBackupFinishDate DATETIME;
SELECT @LastFullBackupFinishDate = MAX(backup_finish_date)
  FROM msdb.dbo.backupset
 WHERE database_name = 'MINTDB'
   AND type = 'D'; -- D = Full Backup

EXEC master.dbo.xp_delete_file
    0,											 -- 0 = backup files
    N'L:\MintDB_Transaction_Log_Files\',         -- folder path
    N'trn',									     -- file extension
    @LastFullBackupFinishDate                    -- delete files older than this datetime
